---
import { i18n } from '@helpers/i18n'
const { lang, translatePath } = i18n(Astro.url)

import type { PostListUI } from '@dtypes/layout_components'

interface Props {
    posts:      PostListUI[];
    small?:     boolean;
    swiper_id?: string;
    is_video?:  boolean;

}

const {
    posts,
    small = false,
    swiper_id = 'posters-reel-swiper',
    is_video = false,
} = Astro.props

import { get_player_icon } from '@helpers/eve_image_server'
import { format_date } from '@helpers/date'

import Wrapper from '@components/compositions/Wrapper.astro';
import Flexblock from '@components/compositions/Flexblock.astro';

import LandingSwiper from '@components/blocks/LandingSwiper.astro';
import PictureCard from '@components/blocks/PictureCard.astro';

import PlayIcon from '@components/icons/buttons/PlayIcon.astro';
---

<Wrapper
    class:list={[ 'posters-reel', { 'posters-reel-small': small} ]}
    padding_block='0'
    padding_inline='0'
    max_width='100%'
>
    <div id={swiper_id} class="[ swiper ][ w-full pb-10! ]">
        <LandingSwiper swiper_selector={`#${swiper_id}`} align={is_video ? 'start' : 'end'}>
            {posts.map(post =>
                <div class="[ swiper-slide ]"
                    style="margin-right: 5px"
                >
                    {!is_video ?
                        <PictureCard
                            src={post.image ? post.image : get_player_icon(post.author.character_id, 512)}
                            alt={post.title}
                            narrow={true}
                            zoomable={post.image ? true : false}
                        >
                            <Flexblock gap='var(--space-3xs)'>
                                <small>{format_date(lang, post.date_posted)}</small>
                                <a href={translatePath(`/propaganda/${post.slug}-${post.post_id}`)}>
                                    <h3>{post.title}</h3>
                                </a>
                            </Flexblock>
                        </PictureCard> :
                        <Flexblock gap='var(--space-xs)'>
                            <a class="[ youtube border ]" href={translatePath(`/propaganda/${post.slug}-${post.post_id}`)}>
                                <PlayIcon />
                                <img
                                    src={post.image ? post.image : get_player_icon(post.author.character_id, 512)}
                                    alt={post.title}
                                />
                            </a>
                            <Flexblock gap='var(--space-3xs)'>
                                <small>{format_date(lang, post.date_posted)}</small>
                                <a href={translatePath(`/propaganda/${post.slug}-${post.post_id}`)}>
                                    <h3>{post.title}</h3>
                                </a>
                            </Flexblock>
                        </Flexblock>
                    }
                    {/*<Flexblock gap='var(--space-2xs)'>
                        <div>
                            <ZoomableImage
                                src={post.image}
                                alt={post.title}
                            />
                            <div class="swiper-lazy-preloader"></div>
                        </div>
                        <Flexblock gap='var(--space-3xs)'>
                            <h4><a href={translatePath(`/propaganda/${post.slug}-${post.post_id}`)}>{post.title}</a></h4>
                            <small>{format_date(lang, post.date_posted)}</small>
                        </Flexblock>
                    </Flexblock>*/}
                </div>
            )}
        </LandingSwiper>
    </div>

    <div id={`${swiper_id}-button-prev`} class="[ swiper-button-prev hidden lg:block! ]"></div>
    <div id={`${swiper_id}-button-next`} class="[ swiper-button-next hidden lg:block! ]"></div>
</Wrapper>

<style lang="scss">
    h3 {
        font-size: var(--step-0);
    }

    .youtube {
        position: relative;

        &:before {
            content: ' ';
            position: absolute;
            inset: 0;
            background-color: var(--background);
            opacity: 0.4;
        }

        :global(svg) {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    }

    :global(.medium-zoom-image--opened) {
        z-index: var(--sticky-z-index);
    }
    :global(.medium-zoom-overlay) {
        z-index: 1;
    }

    .posters-reel {
        position: relative;
    }

    .swiper-button-prev,
    .swiper-button-next {
        --swiper-navigation-color: var(--highlight);
        --swiper-navigation-sides-offset: -46px;

        opacity: 0;
    }

    .swiper-initialized ~ .swiper-button-prev,
    .swiper-initialized ~ .swiper-button-next {
        opacity: 1;
    }

    .swiper-initialized ~ .swiper-button-next.swiper-button-disabled,
    .swiper-initialized ~ .swiper-button-prev.swiper-button-disabled {
        opacity: 0;
    }

    .swiper-button-next.swiper-button-disabled,
    .swiper-button-prev.swiper-button-disabled {
        --swiper-navigation-color: var(--fleet-yellow);
        opacity: 1;
    }

    .swiper-button-prev {
        transform: translateY(-1.25rem);
    }

    .swiper-button-next {
        transform: translateY(-1.25rem);
    }

    .swiper-slide {
        width: min(100%, 350px);
    }

    .posters-reel-small .swiper-slide {
        width: min(100%, 250px);
    }

    .swiper-lazy-preloader {
        border-color: var(--fleet-yellow);
        border-top-color: transparent;
    }

</style>